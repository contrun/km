<!doctype html><html><title>sigma bullets - wiki</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=apple-mobile-web-app-capable content="yes"><meta name=description content="Introduction This document summarize how a zero-knowledge confidential transaction scheme works and how to implement it. A confidential transaction scheme is a transaction scheme with which the transaction value and the balance of the sender and receiver are encrypted. The zero-knowledge part means that outsider can effectively learn nothing about the values, although he can verify the transaction is not fabricated. The main references are Bulletproofs and Zether. We use Zether to homomorphically encrypt the transaction value so that the we can directly add/subtract ciphertext of the encrypted balance which can then be decrypted into the correct balance after the transaction."><link rel=stylesheet href=https://wiki.cont.run/css/main.min.9876f229ece74a87e784cb6ac19f558d58f7c34e91d316c290e35437ca00d7d6.css><body><header><a href=../ id=logo><svg id="Capa_1" enable-background="new 0 0 511.992 511.992" height="512" viewBox="0 0 511.992 511.992" width="512" xmlns="http://www.w3.org/2000/svg"><g><g><g><path d="m256 420.826c0 38.345-11.844 68.545-49.991 68.014-27.744-.385-51.481-15.31-61.853-39.46-1.239-2.887-4.024-4.734-7.154-4.725-.07.0-.135.0-.201.0-47.474.0-75.537-26.171-75.537-73.882.0-5.633.542-11.138 1.568-16.468.62-3.229-.825-6.489-3.671-8.125C23.668 325.748 10 300.053 10 255.997c0-44.057 13.668-69.757 49.161-90.185 2.846-1.636 4.291-4.896 3.671-8.13-1.026-5.33-1.568-10.83-1.568-16.463.0-47.711 28.064-73.882 75.537-73.882h.201c3.13.009 5.915-1.837 7.154-4.729 10.372-24.145 34.109-39.069 61.853-39.455C244.159 22.621 256 52.821 256 91.166" fill="#ff9eb1"/></g><g><g><g><path d="m256 91.166c0-38.344 11.844-68.545 49.991-68.014 27.744.385 51.481 15.31 61.853 39.46 1.239 2.887 4.024 4.734 7.154 4.724h.201c47.474.0 75.537 26.171 75.537 73.882.0 5.633-.542 11.138-1.568 16.468-.62 3.229.825 6.489 3.671 8.125C488.332 186.245 502 211.939 502 255.996s-13.668 69.756-49.161 90.185c-2.846 1.636-4.291 4.896-3.671 8.13 1.026 5.33 1.568 10.83 1.568 16.463.0 47.711-28.064 73.882-75.537 73.882h-.201c-3.13-.009-5.915 1.837-7.154 4.729-10.372 24.145-34.109 39.069-61.853 39.455-38.15.531-49.991-29.669-49.991-68.014" fill="#ff7d97"/></g></g><g><g><path d="m502 265.996c-4.193.0-7.984-2.713-9.407-6.636-1.419-3.912-.16-8.459 3.063-11.092 3.291-2.689 8.009-2.99 11.621-.758 3.568 2.205 5.404 6.578 4.478 10.669-1.02 4.501-5.126 7.817-9.755 7.817z"/></g></g></g><g><path d="m340.83 229.18h-58.013v-58.014h-53.634v58.014H171.17v53.633h58.013v58.013h53.634v-58.013h58.013z" fill="#faf7f5"/></g></g><g><g><path d="m498.468 291.859c-5.141-2.02-10.945.508-12.965 5.648-6.442 16.389-18.055 28.727-37.649 40.005-6.513 3.746-9.932 11.253-8.505 18.689.921 4.783 1.388 9.686 1.388 14.572.0 41.792-22.662 63.882-65.537 63.882h-.225c-.938.0-1.864.074-2.771.217-15.031-4.92-23.796-20.93-19.661-36.479 1.42-5.337-1.757-10.815-7.094-12.234-5.333-1.418-10.814 1.756-12.234 7.094-5.958 22.405 4.241 45.396 23.384 56.443-9.583 17.791-28.602 28.836-50.748 29.145-11.303.146-19.802-2.743-26.011-8.867-9.184-9.057-13.84-25.592-13.84-49.148v-70h16.816c5.522.0 10-4.477 10-10v-48.014h48.014c5.522.0 10-4.477 10-10V229.18c0-5.523-4.478-10-10-10h-48.014v-48.014c0-5.523-4.478-10-10-10H266v-70c0-23.555 4.657-40.09 13.841-49.148 6.21-6.123 14.696-9.022 26.011-8.867 23.862.332 44.096 13.132 52.803 33.405.218.509.458 1.003.719 1.483-3.225 8.243-9.084 15.093-16.833 19.574-8.993 5.2-19.465 6.581-29.485 3.89-5.337-1.434-10.819 1.73-12.251 7.064-1.433 5.334 1.729 10.819 7.063 12.252 5.074 1.363 10.221 2.037 15.338 2.037 10.2.0 20.272-2.681 29.346-7.928 11.083-6.408 19.607-16.017 24.616-27.575 41.6.67 63.569 22.718 63.569 63.866.0 4.89-.467 9.794-1.389 14.582-1.427 7.426 1.991 14.933 8.502 18.678 19.572 11.267 31.176 23.584 37.625 39.936 1.552 3.934 5.318 6.334 9.306 6.333 1.221.0 2.462-.225 3.666-.7 5.138-2.026 7.66-7.834 5.634-12.972-7.943-20.141-22.201-35.773-44.801-49.086.967-5.521 1.457-11.155 1.457-16.772.0-52.114-31.48-83.391-84.288-83.876-12.157-26.863-38.963-43.753-70.318-44.189-16.67-.232-30.255 4.688-40.332 14.625-3.813 3.76-7.08 8.226-9.797 13.382-2.717-5.156-5.984-9.622-9.797-13.382-10.075-9.937-23.668-14.852-40.333-14.625-31.353.437-58.158 17.325-70.32 44.189-52.807.485-84.286 31.762-84.286 83.876.0 5.617.49 11.253 1.458 16.771-37.422 22.031-52.724 50.552-52.724 98.008.0 47.451 15.299 75.969 52.721 98.006-.967 5.521-1.457 11.154-1.457 16.772.0 52.114 31.48 83.391 84.288 83.876 12.157 26.863 38.963 43.753 70.318 44.189.377.005.751.008 1.125.008 16.172.0 29.358-4.92 39.207-14.632 3.813-3.76 7.08-8.226 9.797-13.382 2.717 5.156 5.984 9.622 9.797 13.382 9.849 9.713 23.034 14.633 39.208 14.632.373.0.749-.003 1.125-.008 31.352-.436 58.158-17.325 70.32-44.189 52.807-.485 84.286-31.762 84.286-83.876.0-5.617-.49-11.253-1.458-16.772 22.634-13.329 36.901-28.989 44.838-49.178 2.022-5.14-.507-10.945-5.647-12.966zM282.816 239.18h48.014v33.633h-48.014c-5.522.0-10 4.477-10 10v48.014h-33.633v-48.014c0-5.523-4.477-10-10-10H181.17V239.18h48.014c5.523.0 10-4.477 10-10v-48.014h33.633v48.014c-.001 5.523 4.477 10 9.999 10zm-50.657 230.794c-6.21 6.124-14.717 9.018-26.011 8.867-23.862-.331-44.096-13.132-52.803-33.405-.218-.509-.458-1.003-.719-1.483 3.225-8.243 9.085-15.093 16.833-19.574 8.992-5.2 19.463-6.581 29.485-3.89 5.337 1.434 10.819-1.73 12.251-7.064 1.433-5.333-1.73-10.819-7.064-12.251-15.188-4.08-31.059-1.988-44.684 5.891-11.083 6.408-19.607 16.017-24.616 27.575-41.6-.67-63.569-22.718-63.569-63.866.0-4.89.467-9.794 1.389-14.582 1.427-7.427-1.991-14.934-8.502-18.678-32.183-18.528-44.149-40.621-44.149-81.517.0-40.9 11.966-62.994 44.146-81.517 6.513-3.746 9.932-11.253 8.505-18.689-.921-4.783-1.388-9.686-1.388-14.572.0-41.792 22.662-63.882 65.537-63.882h.225c.938.0 1.864-.074 2.771-.217 15.031 4.92 23.796 20.93 19.661 36.479-1.42 5.337 1.757 10.815 7.094 12.234.861.229 1.726.338 2.577.338 4.422.0 8.467-2.956 9.657-7.432 5.958-22.405-4.241-45.396-23.384-56.443 9.583-17.791 28.602-28.836 50.748-29.145 11.267-.15 19.801 2.743 26.011 8.867 9.184 9.057 13.84 25.592 13.84 49.148v70h-16.816c-5.522.0-10 4.477-10 10v48.014H171.17c-5.522.0-10 4.477-10 10v53.633c0 5.523 4.478 10 10 10h48.014v48.014c0 5.523 4.478 10 10 10H246v70c0 23.554-4.657 40.09-13.841 49.147z"/><path d="m139.699 228.227c-6.766.0-13.186 1.514-18.907 4.31-3.049-8.65-8.286-16.485-15.336-22.673-4.151-3.643-10.469-3.233-14.113.918-3.643 4.15-3.232 10.469.918 14.112 6.711 5.891 10.816 14.143 11.498 22.953-1.213 1.914-2.293 3.946-3.225 6.088-1.145 2.633-2.015 5.316-2.615 8.019-13.414 11.422-33.601 10.834-46.225-1.792-3.906-3.904-10.236-3.904-14.143.0-3.905 3.905-3.905 10.237.0 14.143 10.524 10.524 24.354 15.784 38.193 15.784 8.04.0 16.083-1.775 23.484-5.325 1.904 5.443 4.967 10.557 9.136 15.03.596.639 1.204 1.269 1.826 1.891 1.953 1.953 4.512 2.929 7.071 2.929 2.56.0 5.118-.976 7.071-2.929 3.905-3.905 3.905-10.237.0-14.143-.458-.458-.906-.922-1.342-1.389-6.26-6.716-7.799-15.778-4.118-24.241 2.878-6.616 9.86-13.686 20.826-13.686 5.522.0 10-4.477 10-10 .001-5.522-4.476-9.999-9.999-9.999z"/><path d="m387.667 287.543c-3.905 3.905-3.905 10.237.0 14.143 1.953 1.953 4.512 2.929 7.071 2.929s5.118-.976 7.071-2.929c.622-.622 1.23-1.253 1.83-1.896 4.167-4.471 7.229-9.583 9.133-15.025 7.401 3.549 15.444 5.324 23.484 5.324 13.839.0 27.67-5.261 38.193-15.784 3.905-3.905 3.905-10.237.0-14.143-3.906-3.904-10.236-3.904-14.143.0-12.624 12.625-32.811 13.214-46.225 1.792-.6-2.702-1.47-5.386-2.615-8.019-.932-2.142-2.012-4.175-3.225-6.088.682-8.81 4.787-17.062 11.498-22.953 4.15-3.644 4.561-9.962.918-14.112-3.646-4.151-9.964-4.563-14.113-.918-7.05 6.189-12.287 14.023-15.336 22.673-5.721-2.796-12.141-4.31-18.907-4.31-5.523.0-10 4.477-10 10s4.477 10 10 10c10.966.0 17.948 7.07 20.826 13.686 3.681 8.463 2.142 17.525-4.114 24.237-.44.47-.888.935-1.346 1.393z"/></g></g></g></svg></a><h3 class=site-title>wiki</h3></header><div class=grid-container><div class=grid><div class=page data-level=1><div class=content><h1>sigma bullets</h1><h2 id=introduction>Introduction</h2><p>This document summarize how a zero-knowledge confidential transaction scheme works and how to implement it. A confidential transaction scheme is a transaction scheme with which the transaction value and the balance of the sender and receiver are encrypted. The zero-knowledge part means that outsider can effectively learn nothing about the values, although he can verify the transaction is not fabricated. The main references are <a href=https://eprint.iacr.org/2017/1066>Bulletproofs</a> and <a href=https://eprint.iacr.org/2019/191>Zether</a>. We use Zether to homomorphically encrypt the transaction value so that the we can directly add/subtract ciphertext of the encrypted balance which can then be decrypted into the correct balance after the transaction. We use bulletproofs to check the transaction value is valid, i.e. it is a non-negative number within the range \([0, 2^n)\), and after the transaction the sender must still have a non-negative balance. The vanilla bulletproofs do not apply to the scenario of zether as Elgamal commitments are not fully homomorphic. We need to tweak bulletproofs to support \(\Sigma\)-protocols, i.e. interactive proof of the values commited in Bulletproofs are truly the values involved in zether, whence we obtain a complete and sound proof of a confidential transaction.</p><h2 id=encryption-and-decryption-of-balance>Encryption and Decryption of Balance</h2><p>From now no, Let \(G\) be a group where the discrete logarithm problem is assumed to be hard to solve. Let \(g, \overrightarrow{g}=(g_1, g_2, \cdots), h, \overrightarrow{h}=(h_1, h_2, \cdots)\) be base points of \(G\) whose logarithm relationship is unclear.</p><p>Let \(y_1 = sk_1 * g\) (resp. \(y_2 = sk_2 * g\)) be public key of secret key \(sk_1\) (resp. \(sk_2\)). Assume the balance of every account is in the interval \([0, 2^n)\), where \(n\) is a small integer like 32. The ciphertexts obtained from encrypting balance \(b_1\) (resp. \(b_2\)) with public key \(y_1\) (resp. \(y_2\)) is \(c_1 = (b_1 * g + r_1 *y_1, r_1 * g)\) (resp. \(c_2 = (b_2 * g + r_2 * y_2, r_2 * g)\)), where \(r_1\) and \(r_2\) are random scalars. This is also called ElGamal Commitment.</p><p>Using the usual ElGamal decryption, we can obtain \(b_1 * g\) (resp. \(b_2 * g\)) from ciphertext \(c_1\) (resp. \(c_2\)), i.e. we calculate \((b_1 * g + r_1 * y_1) - (sk_1 * r_1 * g)\) which equals \(b_1 * g\) by definition of the public key \(y_1 = sk_1 * g\). We then obtain \(b_1\) (resp. \(b_2\)) with brute force. This is feasible as \(b_1, b_2\) are small enough.</p><h2 id=confidential-transfer>Confidential Transfer</h2><p>For the same public key \(y\), we define the addition/subtraction of two ciphertexts \(c_1 = (b_1 * g + r_1 * y, r_1 * g)\) and \(c_2 = (b_2 * g + r_2 * y, r_2 * g)\) as the multiplication/division in the group \(G^2\), for example define \(c_1 + c_2 = ((b_1 + b_2) * g + (r_1+r_2) * y, (r_1+r_2) * g)\). It is easy to verify the decryption of the resulting ciphertext is indeed the addition/subtraction of corresponding balance.</p><p>That is to say, the mapping from balance interval to ciphertext homomorphic, we can do the math on ciphertexts which corresponds exactly to the math on balances.</p><p>We want to make a transaction from account \(Y\) to account \(\bar{Y}\), we assume \(Y\) initially has balance \(b\), he/she wants to transfer \(b^\star\) to \(\bar{Y}\). In the good old bitcoin world. We need only check, it is indeed \(Y\) made the transaction, and \(Y\) didn&rsquo;t transfer more than what he/she has, i.e. \(b\).</p><p>In the brave new world of cryptopia, we have no way to know what \(b\) and \(b^\star\) are, as they are both encrypted.</p><h2 id=proof-of-knowledge-of-discrete-logarithm>Proof of knowledge of discrete logarithm</h2><p>Let&rsquo;s summarize what we need to do.</p><p>Suppose \(Y\), whose public key is \(y\), secret key is \(sk\), wants to transfer \(b^\star\) to \(\bar{Y}\), whose public key is \(\bar{y}\), in the end, X has only \(b^\prime\) left in his/her wallet. Our goal is then to prove the following statements.</p><ol><li>The ciphertext \((C, D)\) of \(b^\star\) under public key \(y\) and random number \(r\) is \((b^\star * g + r * y, r * g)\).</li><li>The ciphertext \((\bar{C}, D)\) of \(b^\star\) under public key \(\bar{y}\) and random number \(r\) is \((b^\star * g + r * \bar{y}, r * g)\). Note we also enforce \(b^\star\) is encrypted under the same random number \(r\).</li><li>\(C_{n}, D_{n}\), the amount of money of \(Y\) left after the transaction is the ElGamal encryption of \(b^\prime\) under public key \(y\), i.e. \(C_n = b^\star * g + sk * D_n\) and \(sk * g = y\).</li><li>Both \(b^\star\) and \(b^\prime\) are within the range \([0, 2^n)\).</li></ol><p>We can make use of Schnorr&rsquo;s protocol to prove the first three statements.</p><p>In Schnorr&rsquo;s protocol, the prover wants to prove that he knows \(x\) such that \((x, h)\) satisfies relationship \(h = x * g\) where \(g\) is a known element of group \(G\), and \(x\) is hidden. Schnorr&rsquo;s protocol. First the prover randomly choose a scalar \(r\) and send \(u = r * g\) to the verifier. The verifier send the randomly chosen challenge \(c\) to the prover. The honest prover send \(v = (c * x + r) * g\) to the verifier. The verifier outputs \( v == c*h + u \).</p><p>With little changes, we can extend Schnorr&rsquo;s protocol to prove statements like \(C = b^\star * g + r * y\). Now We need only a proof which proves both \(b^\star\) and \(b^\prime\) are within the range \([0, 2^n)\), without ever revealing the actual values. In order to do so, we will first commit the value, and then prove properties concerning the commitment.</p><h2 id=pederson-commitment>Pederson Commitment</h2><p>We now provide another way to hide balance which also allow us prove to statements about the hidden balance. Given a value \(v\) in the message space, we can commit this value and obtain a output \(c\) in the commitment space. \(c\) is called the commitment of \(v\).</p><p>There are two properties concerning the security of a commitment scheme, binding and hiding. Informally, a commitment is said to be binding if we can not find two values whose commitment are equal, a commitment is said to be hiding is we can not discern two values from each other. If in addition to this two properties, the commitment scheme is homomorphic, then we translate statements from message space to commitment space. This is quite useful for us to prove properties of hidden values.</p><p>One of the hiding, binding and homomorphic commitment schemes is Pederson commitment. The Pederson commitment of \((b, r) \in (\mathbb{Z}, \mathbb{Z})\) is defined to be the function \(PC: (b, r) \mapsto b*g + r*h\) where \(g\) and \(h\) are fixed base points, \(r\) is called the blinding factor of \(b\). Note that in Pederson Commitment \(h\) is fixed. We can easily verify Pedenson commitment is a homomorphic commitment scheme, i.e. \(\forall b_1, r_1, b_2, r_2\), we have \(PC(b_1+b_2, r_1+r_2) = PC(b_1, r_1) + PC(b_2, r_2)\).</p><p>We generalize Pederson Commitment to vectors. Let \((\overrightarrow{a_L}, \overrightarrow{a_R}) \in (\mathbb{Z}^n, \mathbb{Z}^n)\), we define the Pederson commitment to be the function \(PC: (\overrightarrow{a_L}, \overrightarrow{a_R}, r) \mapsto \sum a_{L_i} * g_i + \sum a_{R_i} * h_i + rh\) where \(h\), \(g_i\) and \(h_i\) are fixed base points, \(r\) is called the blinding factor of \((\overrightarrow{a_L}, \overrightarrow{a_R})\).</p><h2 id=zen-of-range-checking>Zen of Range Checking</h2><p>Instead of proving \(a\) is within the range \([0, 2^n)\) directly. We prove the following equivalent equation.</p><p><a id=org7e48bfd></a></p><p>\[a - \sum_{i=1}^{n} a_{L_i} \times 2^{i-1} = 0 \text{ (eqn:1)}\]</p><p><a id=orgfdf6836></a></p><p>\[a_{L_i} - 1 - a_{R_i} = 0, \forall i = 1, \cdots, n \text{ (eqn:2)}\]</p><p><a id=orgc7e8677></a></p><p>\[a_{R_i} * a_{L_i} = 0, \forall i = 1, \cdots, n \text{ (eqn:3)}\]</p><p>Combining <a href=#orgfdf6836>1</a> and <a href=#orgc7e8677>1</a>, we have \((a_{L_i} - 1) * a_{L_i} = 0\), i.e. \(a_{L_i} = 1\) or \(a_{L_i} = 0\). Together with the first equation, we can see that \(a_{L_i}\) is the binary representation of \(a\). As we have only \(n\) \(a_{L_i}\), \(a\) is indeed within the range \([0, 2^n)\).</p><p>Denote \(\overrightarrow{y_n}\), or simply \(\overrightarrow{y}\) when \(n\) is clear, \((1, y, \cdots, y^{n-1})\), \(overrightarrow{a_L} = (a_{L_1}, a_{L_2}, \cdots, a_{L_n})\), \(\overrightarrow{a_R} = (a_{R_1}, a_{R_2}, \cdots, a_{R_n})\). Let \(X\), \(Y\) be two vector in \(\mathbb{Z}^n\), we denote the Euclid inner product \(X\cdot Y\), the Hermitian product \(X \circ Y\).</p><p>To verify the second equation, the verifier makes a challenge, a random scalar \(y\), to the prove. The prover proves that,</p><p><a id=org7013f49></a></p><p>\[ \sum_{i=1}^{i=n} (a_{L_i} - 1 - a_{R_i}) * y^{i-1} = 0 \text{ (eqn:4)}\]</p><p>The left side of the above equation is a polynomial of degree at most \(n-1\), so it has at most \(n-1\) roots. \(y\) is highly unlikely to be a root of the polynomial unless all coefficients are zero.</p><p>Using the same argument, verifying the following equation is enough for the third equation.</p><p><a id=org654654a></a></p><p>\[ \sum_{i=1}^{i=n} (a_{L_i} * a_{R_i}) * y^{i-1} = 0 \text{ (eqn:5)}\]</p><p>Rewrite equation <a href=#org7013f49>1</a> as \((\overrightarrow{a_L} - \overrightarrow{1_n} - \overrightarrow{a_R}) \cdot \overrightarrow{y_n} = 0\), rewrite equation <a href=#org654654a>1</a> as \((\overrightarrow{a_L}) \cdot (\overrightarrow{a_R} \circ \overrightarrow{y_n}) = 0\), rewrite <a href=#org7e48bfd>1</a> as \(a - \overrightarrow{a_L} \cdot \overrightarrow{2_n} = 0\). Using the trick as above, we combine this equations to a single equation</p><p><a id=org47feb4b></a></p><p>\[(\overrightarrow{a_L} - \overrightarrow{1_n} - \overrightarrow{a_R}) \cdot \overrightarrow{y_n} + \overrightarrow{a_L}\cdot (\overrightarrow{a_R} \circ \overrightarrow{y_n}) * z + (a - \overrightarrow{a_L} \cdot \overrightarrow{2_n})* z^2 = 0 \text{ (eqn:6)}\]</p><p>This equation is equivalent to</p><p><a id=org27c42a6></a></p><p>\[(\overrightarrow{a_L} - z\overrightarrow{1_n}) \cdot (\overrightarrow{a_R}\circ \overrightarrow{y_n} + z\overrightarrow{1_n}\circ \overrightarrow{y_n} + z^2 \overrightarrow{2_n}) = z^2 v + \delta(y, z) \text{ (eqn:7)}\]</p><p>where \(\delta(y, z) = (z - z^2)(\overrightarrow{1_n} \cdot \overrightarrow{y_n}) - z^3 (\overrightarrow{1_n} \cdot \overrightarrow{2_n})\) is a term involves only \(y\) and \(z\).</p><p>In order to make the range proof zero knowledge, we will add additional term \(\overrightarrow{s_L}x\) (resp. \(\overrightarrow{s_R}x\)) to \(\overrightarrow{a_L}\) (resp. \(\overrightarrow{a_R}\)), where \(\overrightarrow{s_L}, \overrightarrow{s_R} \in \mathbb{Z}^n\) are random vectors, \(x\) is unknown variable in \(\mathbb{Z}\). Thus the left-hand side of equation <a href=#org27c42a6>1</a> is now a polynomial in \(x\) of degree 2. Adjust the right-hand side to a polynomial in \(x\) of degree 2, Then we have a equation of the following form</p><p><a id=org07f3d17></a></p><p>\[\overrightarrow{l(x)} \cdot \overrightarrow{r(x)} = t(x) \text{ (eqn:8)}\]</p><p>where</p><p><a id=orgd4bbf6a></a></p><p>\[\overrightarrow{l(x)} = \overrightarrow{a_L} + \overrightarrow{s_L}x - z\overrightarrow{1_n} \text{ (eqn:9)}\]</p><p><a id=org1a865e6></a></p><p>\[\overrightarrow{r(x)} = (\overrightarrow{a_R} + \overrightarrow{s_R}x) \circ \overrightarrow{y_n} + z\overrightarrow{1_n}\circ \overrightarrow{y_n} + z^2 \overrightarrow{2_n} \text{ (eqn:10)}\]</p><p><a id=org70e62ff></a></p><p>\[t(x) = t_0 + t_1 x + t_2 x^2 = z^2 v + \delta(y, z) + t_1 x + t_2 x^2 \text{ (eqn:11)}\]</p><h2 id=range-proof>Range Proof</h2><p>We now view \(x\) as a chosen random scalar. Let \(V\) be the Pederson Commitment of \(v\), \(T_1\) be the Pederson Commitment of \(t_1\), \(T_2\) be the Pederson Commitment of \(t_2\), \(A = PC(\overrightarrow{a_L}, \overrightarrow{a_R}, \tilde{a})\), \(S = PC(\overrightarrow{s_L}, \overrightarrow{s_R}, \tilde{s})\), \(P = PC(\overrightarrow{l(x)}, \overrightarrow{r(x)}, \tilde{p})\).</p><p>The range proof consists of \((V, A, S, T_1, T_2, \tilde{t}(x), t(x), \tilde{p})\) and a proof which proves that \(t(x)\) is indeed the inner product of \(\overrightarrow{l(x)}\) and \(\overrightarrow{r(x)}\), i.e. <a href=#org07f3d17>1</a> holds.</p><p>To verify <a href=#orgd4bbf6a>1</a> and <a href=#org1a865e6>1</a>, we note that knowing the blinding factor, the Pederson commitment of \((\overrightarrow{a_L} + \overrightarrow{s_L}x - z\overrightarrow{1_n}, (\overrightarrow{a_R} + \overrightarrow{s_R}x) \circ \overrightarrow{y_n} + z\overrightarrow{1_n}\circ \overrightarrow{y_n} + z^2 \overrightarrow{2_n})\) can be calculated from \(A, S\). Given the blinding factor of the Pedenson commitment of \(\overrightarrow{l(x)}, \overrightarrow{r(x)}\), we can calculate the commitment of \((\overrightarrow{l(x)}, \overrightarrow{r(x)})\) in the inner product proof. Thus we can only verify the given inner product proof with the commitment calculated from above.</p><p>To verify <a href=#org70e62ff>1</a>, we compare the commitment of \(t(x)\) with the commitment of \(z^2 v + \delta(y, z) + t_1 x + t_2 x^2\). The first term can be calculated directly with \(\tilde{t}(x), t(x)\), and the second term can be calculated with \(V, T_1, T_2\).</p><h2 id=aggregated-range-proof>Aggregated Range Proof</h2><p>In our use case, we want to aggregate two range proofs. To aggregate range proofs of terms \(a^{(k)}, k = 1, \cdots, m\) are within the range \([0, 2^n)\), we have the following equations</p><p><a id=org3275183></a></p><p>\[ a^{(k)} - \sum_{i=1}^{n} a^{(k)}_{L_i} \times 2^{i-1} = 0, \forall k = 1, \cdots, m \text{ (eqn:12)}\]</p><p><a id=orgfc28cc7></a></p><p>\[a^{(k)}_{L_i} - 1 - a^{(k)}_{R_i} = 0, \forall i = 1, \cdots, n, \forall k = 1, \cdots, m \text{ (eqn:13)}\]</p><p><a id=orgbbd3811></a></p><p>\[a^{(k)}_{R_i} * a^{(k)}_{L_i} = 0, \forall i = 1, \cdots, n, \forall k = 1, \cdots, m \text{ (eqn:14)}\]</p><p>Note when we concatenate all the binary representation of \(\overrightarrow{a^{(k)}_{L}}\) (resp. \(\overrightarrow{a^{(k)}_{R}}\)) into \(\overrightarrow{a_{L}}\) (resp. \(\overrightarrow{a_{R}}\)), we can condense <a href=#orgfc28cc7>1</a> (resp. <a href=#orgbbd3811>1</a>) into the <a href=#orgfdf6836>1</a> (resp. <a href=#orgc7e8677>1</a>). We use the same trick as before to compress equations in <a href=#org3275183>1</a>, then we have
\[(\overrightarrow{a_L} - \overrightarrow{1_{mn}} - \overrightarrow{a_R}) \cdot \overrightarrow{y_{mn}} + \overrightarrow{a_L}\cdot (\overrightarrow{a_R} \circ \overrightarrow{y_{mn}}) * z + \sum_k(a^{(k)} - \overrightarrow{a^{(k)}_{L}} \cdot \overrightarrow{2_n}) * z^{2+k} = 0\]</p><p>Accordingly, we adjust terms in <a href=#orgd4bbf6a>1</a>, <a href=#org1a865e6>1</a> and <a href=#org70e62ff>1</a>. After that, we can verify the proof in the same way. Now we have got rid of all the roadblocks. A zero-knowledge confidential transaction scheme is here to stay.</p></div></div></div></div><script src=https://wiki.cont.run/js/URI.js type=text/javascript></script><script src=https://wiki.cont.run/js/page.js type=text/javascript></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></body></html>